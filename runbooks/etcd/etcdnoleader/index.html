<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="etcdNoLeader # Meaning # This alert is triggered when etcd cluster does not have a leader for more than 1 minute. This can happen if nodes from the cluster are orphaned - they were part of the cluster but now they are in minority and thus can not form a cluster, for example due to network partition.
Impact # When there is no leader, Kubernetes API will not be able to work as expected and cluster cannot process any writes or reads, and any write requests are queued for processing until a new leader is elected."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="etcdNoLeader # Meaning # This alert is triggered when etcd cluster does not have a leader for more than 1 minute. This can happen if nodes from the cluster are orphaned - they were part of the cluster but now they are in minority and thus can not form a cluster, for example due to network partition.
Impact # When there is no leader, Kubernetes API will not be able to work as expected and cluster cannot process any writes or reads, and any write requests are queued for processing until a new leader is elected."><meta property="og:type" content="article"><meta property="og:url" content="https://defenestration.github.io/runbooks/runbooks/etcd/etcdnoleader/"><meta property="article:section" content="runbooks"><title>Etcd No Leader | kube-prometheus runbooks</title><link rel=manifest href=/runbooks/manifest.json><link rel=icon href=/runbooks/favicon.png type=image/x-icon><link rel=stylesheet href=/runbooks/book.min.958cea7827621d6fbcb3acf091344c3e44e3d2a9428f9c3c38bb9eb37bf8c45d.css integrity="sha256-lYzqeCdiHW+8s6zwkTRMPkTj0qlCj5w8OLues3v4xF0=" crossorigin=anonymous><script defer src=/runbooks/flexsearch.min.js></script>
<script defer src=/runbooks/en.search.min.bf087d356c72e0d10d8d4f219675389fb4ae60fa963168b012a91d6d18f19dec.js integrity="sha256-vwh9NWxy4NENjU8hlnU4n7SuYPqWMWiwEqkdbRjxnew=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/runbooks/><span>kube-prometheus runbooks</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><input type=checkbox id=section-77747a9d3152fa2d9804f647f1c86ce5 class=toggle>
<label for=section-77747a9d3152fa2d9804f647f1c86ce5 class="flex justify-between"><a role=button>general</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/general/infoinhibitor/>Info Inhibitor</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/general/nodenetworkinterfaceflapping/>Node Network Interface Flapping</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/general/watchdog/>Watchdog</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/general/targetdown/>Target Down</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-8a9628b913ed2d2ebcb204a774d910f4 class=toggle>
<label for=section-8a9628b913ed2d2ebcb204a774d910f4 class="flex justify-between"><a role=button>alertmanager</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerclustercrashlooping/>Alertmanager Cluster Crashlooping</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerclusterdown/>Alertmanager Cluster Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerclusterfailedtosendalerts/>Alertmanager Cluster Failed To Send Alerts</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerconfiginconsistent/>Alertmanager ConfigInconsistent</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerfailedtosendalerts/>Alertmanager Failed To Send Alerts</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagermembersinconsistent/>Alertmanager Members Inconsistent</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerfailedreload/>AlertmanagerFailedReload</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-a3239edffad56d0bac2aa416aa6229aa class=toggle checked>
<label for=section-a3239edffad56d0bac2aa416aa6229aa class="flex justify-between"><a role=button>etcd</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdbackendquotalowspace/>Etcd Backend Quota Low Space</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdgrpcrequestsslow/>Etcd Grpcrequests Slow</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdhighfsyncdurations/>Etcd High Fsync Durations</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdhighnumberoffailedgrpcrequests/>Etcd High Number of Failed Grpcrequests</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdinsufficientmembers/>Etcd Insufficient Members</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdmembersdown/>Etcd Members Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdnoleader/ class=active>Etcd No Leader</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-5985c1df24eaf5f98ff50cd2aba6514b class=toggle>
<label for=section-5985c1df24eaf5f98ff50cd2aba6514b class="flex justify-between"><a role=button>kube-state-metrics</a></label><ul></ul></li><li class=book-section-flat><input type=checkbox id=section-96dded8b3c9feb1c3fa3dff530c60250 class=toggle>
<label for=section-96dded8b3c9feb1c3fa3dff530c60250 class="flex justify-between"><a role=button>kubernetes</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeapidown/>Kube API Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeapierrorbudgetburn/>Kube API Error Budget Burn</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubejobfailed/>Kube Job Failed</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeletdown/>Kubelet Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubelettoomanypods/>Kubelet Too Many Pods</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubenodenotready/>Kube Node Not Ready</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubepersistentvolumefillingup/>Kube Persistent Volume Filling Up</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeschedulerdown/>Kube Scheduler Down</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-c29e8d824e17b7d901bc170a7d0435b2 class=toggle>
<label for=section-c29e8d824e17b7d901bc170a7d0435b2 class="flex justify-between"><a role=button>node</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefiledescriptorlimit/>Node File Descriptor Limit</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemalmostoutoffiles/>Node Filesystem Almost Out of Files</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemalmostoutofspace/>Node Filesystem Almost Out of Space</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemfilesfillingup/>Node Filesystem Files Filling Up</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemspacefillingup/>Node Filesystem Space Filling Up</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/noderaiddegraded/>Node Raiddegraded</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-67010990d531fdafbd578205491897d5 class=toggle>
<label for=section-67010990d531fdafbd578205491897d5 class="flex justify-between"><a role=button>prometheus</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusbadconfig/>Prometheus Bad Config</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusduplicatetimestamps/>Prometheus Duplicate Timestamps</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusoutofordertimestamps/>Prometheus Out of Order Timestamps</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusrulefailures/>Prometheus Rule Failures</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheustargetsyncfailure/>Prometheus Target Sync Failure</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-10a9331d031c9e488862183af9bf7d32 class=toggle>
<label for=section-10a9331d031c9e488862183af9bf7d32 class="flex justify-between"><a role=button>prometheus-operator</a></label><ul></ul></li></ul><ul><li><a href=/runbooks/docs/add-runbook/>Add Runbook</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/runbooks/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Etcd No Leader</strong>
<label for=toc-control><img src=/runbooks/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#meaning>Meaning</a></li><li><a href=#impact>Impact</a></li><li><a href=#diagnosis>Diagnosis</a><ul><li><a href=#control-plane-nodes-issue>Control plane nodes issue</a></li><li><a href=#slow-disk-issue>Slow disk issue</a></li><li><a href=#other>Other</a></li></ul></li><li><a href=#mitigation>Mitigation</a><ul><li><a href=#disaster-and-recovery>Disaster and recovery</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=etcdnoleader>etcdNoLeader
<a class=anchor href=#etcdnoleader>#</a></h1><h2 id=meaning>Meaning
<a class=anchor href=#meaning>#</a></h2><p>This alert is triggered when etcd cluster does not have a leader for more than 1
minute.
This can happen if nodes from the cluster are orphaned - they were part of the cluster
but now they are in minority and thus can not form a cluster,
for example due to network partition.</p><h2 id=impact>Impact
<a class=anchor href=#impact>#</a></h2><p>When there is no leader, Kubernetes API will not be able to work
as expected and cluster cannot process any writes or reads, and any write
requests are queued for processing until a new leader is elected. Operations
that preserve the health of the workloads cannot be performed.</p><p>In general loosing quorum will switch etcd to read only, which effectively renders k8s api read only.
It is possible to read the current state, but not possible to update it.</p><h2 id=diagnosis>Diagnosis
<a class=anchor href=#diagnosis>#</a></h2><h3 id=control-plane-nodes-issue>Control plane nodes issue
<a class=anchor href=#control-plane-nodes-issue>#</a></h3><p>This can occur multiple control plane nodes are powered off or are unable to
connect each other via the network. Check that all control plane nodes are
powered and that network connections between each machine are functional.</p><h3 id=slow-disk-issue>Slow disk issue
<a class=anchor href=#slow-disk-issue>#</a></h3><p>Another potential cause could be slow disk, inspect the <code>Disk Sync Duration</code>dashboard, as well as the <code>Total Leader Elections Per Day</code> to get more
insight and help with diagnosis.</p><h3 id=other>Other
<a class=anchor href=#other>#</a></h3><p>Check the logs of etcd containers to see any further information and to verify
that etcd does not have leader.
Logs should contain something like <code>etcdserver: no leader</code>.</p><h2 id=mitigation>Mitigation
<a class=anchor href=#mitigation>#</a></h2><h3 id=disaster-and-recovery>Disaster and recovery
<a class=anchor href=#disaster-and-recovery>#</a></h3><p>Follow the steps described in the <a href=https://docs.openshift.com/container-platform/4.7/backup_and_restore/control_plane_backup_and_restore/disaster_recovery/about-disaster-recovery.html>disaster-recovery</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/defenestration/runbooks/edit/main/content/runbooks/etcd/etcdNoLeader.md target=_blank rel=noopener><img src=/runbooks/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#meaning>Meaning</a></li><li><a href=#impact>Impact</a></li><li><a href=#diagnosis>Diagnosis</a><ul><li><a href=#control-plane-nodes-issue>Control plane nodes issue</a></li><li><a href=#slow-disk-issue>Slow disk issue</a></li><li><a href=#other>Other</a></li></ul></li><li><a href=#mitigation>Mitigation</a><ul><li><a href=#disaster-and-recovery>Disaster and recovery</a></li></ul></li></ul></nav></div></aside></main></body></html>