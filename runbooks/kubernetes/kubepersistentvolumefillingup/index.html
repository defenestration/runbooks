<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="KubePersistentVolumeFillingUp # There can be various reasons why a volume is filling up. This runbook does not cover application specific reasons, only mitigations for volumes that are legitimately filling.
Volume resizing # If volume resizing is available, it&rsquo;s easiest to increase the capacity of the volume.
To check if volume expansion is available, run this with your namespace and PVC-name replaced.
$ kubectl get storageclass `kubectl -n <my-namespace> get pvc <my-pvc> -ojson | jq -r '."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="KubePersistentVolumeFillingUp # There can be various reasons why a volume is filling up. This runbook does not cover application specific reasons, only mitigations for volumes that are legitimately filling.
Volume resizing # If volume resizing is available, it&rsquo;s easiest to increase the capacity of the volume.
To check if volume expansion is available, run this with your namespace and PVC-name replaced.
$ kubectl get storageclass `kubectl -n <my-namespace> get pvc <my-pvc> -ojson | jq -r '."><meta property="og:type" content="article"><meta property="og:url" content="https://defenestration.github.io/runbooks/runbooks/kubernetes/kubepersistentvolumefillingup/"><meta property="article:section" content="runbooks"><title>Kube Persistent Volume Filling Up | kube-prometheus runbooks</title><link rel=manifest href=/runbooks/manifest.json><link rel=icon href=/runbooks/favicon.png type=image/x-icon><link rel=stylesheet href=/runbooks/book.min.958cea7827621d6fbcb3acf091344c3e44e3d2a9428f9c3c38bb9eb37bf8c45d.css integrity="sha256-lYzqeCdiHW+8s6zwkTRMPkTj0qlCj5w8OLues3v4xF0=" crossorigin=anonymous><script defer src=/runbooks/flexsearch.min.js></script>
<script defer src=/runbooks/en.search.min.bf087d356c72e0d10d8d4f219675389fb4ae60fa963168b012a91d6d18f19dec.js integrity="sha256-vwh9NWxy4NENjU8hlnU4n7SuYPqWMWiwEqkdbRjxnew=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/runbooks/><span>kube-prometheus runbooks</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><input type=checkbox id=section-77747a9d3152fa2d9804f647f1c86ce5 class=toggle>
<label for=section-77747a9d3152fa2d9804f647f1c86ce5 class="flex justify-between"><a role=button>general</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/general/infoinhibitor/>Info Inhibitor</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/general/nodenetworkinterfaceflapping/>Node Network Interface Flapping</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/general/watchdog/>Watchdog</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/general/targetdown/>Target Down</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-8a9628b913ed2d2ebcb204a774d910f4 class=toggle>
<label for=section-8a9628b913ed2d2ebcb204a774d910f4 class="flex justify-between"><a role=button>alertmanager</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerclustercrashlooping/>Alertmanager Cluster Crashlooping</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerclusterdown/>Alertmanager Cluster Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerclusterfailedtosendalerts/>Alertmanager Cluster Failed To Send Alerts</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerconfiginconsistent/>Alertmanager ConfigInconsistent</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerfailedtosendalerts/>Alertmanager Failed To Send Alerts</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagermembersinconsistent/>Alertmanager Members Inconsistent</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/alertmanager/alertmanagerfailedreload/>AlertmanagerFailedReload</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-a3239edffad56d0bac2aa416aa6229aa class=toggle>
<label for=section-a3239edffad56d0bac2aa416aa6229aa class="flex justify-between"><a role=button>etcd</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdbackendquotalowspace/>Etcd Backend Quota Low Space</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdgrpcrequestsslow/>Etcd Grpcrequests Slow</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdhighfsyncdurations/>Etcd High Fsync Durations</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdhighnumberoffailedgrpcrequests/>Etcd High Number of Failed Grpcrequests</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdinsufficientmembers/>Etcd Insufficient Members</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdmembersdown/>Etcd Members Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/etcd/etcdnoleader/>Etcd No Leader</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-5985c1df24eaf5f98ff50cd2aba6514b class=toggle>
<label for=section-5985c1df24eaf5f98ff50cd2aba6514b class="flex justify-between"><a role=button>kube-state-metrics</a></label><ul></ul></li><li class=book-section-flat><input type=checkbox id=section-96dded8b3c9feb1c3fa3dff530c60250 class=toggle checked>
<label for=section-96dded8b3c9feb1c3fa3dff530c60250 class="flex justify-between"><a role=button>kubernetes</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeapidown/>Kube API Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeapierrorbudgetburn/>Kube API Error Budget Burn</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubejobfailed/>Kube Job Failed</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeletdown/>Kubelet Down</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubelettoomanypods/>Kubelet Too Many Pods</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubenodenotready/>Kube Node Not Ready</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubepersistentvolumefillingup/ class=active>Kube Persistent Volume Filling Up</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/kubernetes/kubeschedulerdown/>Kube Scheduler Down</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-c29e8d824e17b7d901bc170a7d0435b2 class=toggle>
<label for=section-c29e8d824e17b7d901bc170a7d0435b2 class="flex justify-between"><a role=button>node</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefiledescriptorlimit/>Node File Descriptor Limit</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemalmostoutoffiles/>Node Filesystem Almost Out of Files</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemalmostoutofspace/>Node Filesystem Almost Out of Space</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemfilesfillingup/>Node Filesystem Files Filling Up</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/nodefilesystemspacefillingup/>Node Filesystem Space Filling Up</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/node/noderaiddegraded/>Node Raiddegraded</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-67010990d531fdafbd578205491897d5 class=toggle>
<label for=section-67010990d531fdafbd578205491897d5 class="flex justify-between"><a role=button>prometheus</a></label><ul><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusbadconfig/>Prometheus Bad Config</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusduplicatetimestamps/>Prometheus Duplicate Timestamps</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusoutofordertimestamps/>Prometheus Out of Order Timestamps</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheusrulefailures/>Prometheus Rule Failures</a></li><li><a href=https://defenestration.github.io/runbooks/runbooks/prometheus/prometheustargetsyncfailure/>Prometheus Target Sync Failure</a></li></ul></li><li class=book-section-flat><input type=checkbox id=section-10a9331d031c9e488862183af9bf7d32 class=toggle>
<label for=section-10a9331d031c9e488862183af9bf7d32 class="flex justify-between"><a role=button>prometheus-operator</a></label><ul></ul></li></ul><ul><li><a href=/runbooks/docs/add-runbook/>Add Runbook</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/runbooks/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Kube Persistent Volume Filling Up</strong>
<label for=toc-control><img src=/runbooks/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#volume-resizing>Volume resizing</a></li><li><a href=#migrate-data-to-a-new-larger-volume>Migrate data to a new, larger volume</a></li><li><a href=#purge-volume>Purge volume</a></li></ul></nav></aside></header><article class=markdown><h1 id=kubepersistentvolumefillingup>KubePersistentVolumeFillingUp
<a class=anchor href=#kubepersistentvolumefillingup>#</a></h1><p>There can be various reasons why a volume is filling up. This runbook does not cover application specific reasons, only mitigations for volumes that are legitimately filling.</p><h2 id=volume-resizing>Volume resizing
<a class=anchor href=#volume-resizing>#</a></h2><p>If volume resizing is available, it&rsquo;s easiest to increase the capacity of the volume.</p><p>To check if volume expansion is available, run this with your namespace and PVC-name replaced.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get storageclass <span style=color:#e6db74>`</span>kubectl -n &lt;my-namespace&gt; get pvc &lt;my-pvc&gt; -ojson | jq -r <span style=color:#e6db74>&#39;.spec.storageClassName&#39;</span><span style=color:#e6db74>`</span>       
</span></span><span style=display:flex><span>NAME                 PROVISIONER            RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
</span></span><span style=display:flex><span>standard <span style=color:#f92672>(</span>default<span style=color:#f92672>)</span>   kubernetes.io/gce-pd   Delete          Immediate           true                   28d
</span></span></code></pre></div><p>In this case <code>ALLOWVOLUMEEXPANSION</code> is true, so we can make use of the feature.</p><p>To resize the volume run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n &lt;my-namespace&gt; edit pvc &lt;my-pvc&gt;
</span></span></code></pre></div><p>And edit <code>.spec.resources.requests.storage</code> to the new desired storage size. Eventually the PVC status will say &ldquo;Waiting for user to (re-)start a pod to finish file system resize of volume on node.&rdquo;</p><p>You can check this with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n &lt;my-namespace&gt; get pvc &lt;my-pvc&gt;
</span></span></code></pre></div><p>Once the PVC status says to restart the respective pod, run this to restart it (this automatically finds the pod that mounts the PVC and deletes it, if you know the pod name, you can also just simply delete that pod):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n &lt;my-namespace&gt; delete pod <span style=color:#e6db74>`</span>kubectl -n &lt;my-namespace&gt; get pod -ojson | jq -r <span style=color:#e6db74>&#39;.items[] | select(.spec.volumes[] .persistentVolumeClaim.claimName==&#34;&lt;my-pvc&gt;&#34;) | .metadata.name&#39;</span><span style=color:#e6db74>`</span>
</span></span></code></pre></div><h2 id=migrate-data-to-a-new-larger-volume>Migrate data to a new, larger volume
<a class=anchor href=#migrate-data-to-a-new-larger-volume>#</a></h2><p>When resizing is not available and the data is not safe to be deleted, then the only way is to create a larger volume and migrate the data.</p><p>TODO</p><h2 id=purge-volume>Purge volume
<a class=anchor href=#purge-volume>#</a></h2><p>When the data is ephemeral and volume expansion is not available, it may be best to purge the volume.</p><p>WARNING/DANGER: This will permanently delete the data on the volume. Performing these steps is your responsibility.</p><p>TODO</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/defenestration/runbooks/edit/main/content/runbooks/kubernetes/KubePersistentVolumeFillingUp.md target=_blank rel=noopener><img src=/runbooks/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#volume-resizing>Volume resizing</a></li><li><a href=#migrate-data-to-a-new-larger-volume>Migrate data to a new, larger volume</a></li><li><a href=#purge-volume>Purge volume</a></li></ul></nav></div></aside></main></body></html>